<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../CSS/newFacture.css" type="text/css">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
        <title>Garage Buron</title>
    </head>
    <body>
		<div class="container">
			<div class="row">
				<div class="col-md-6 col-md-offset-3">
					<h1>Garage Buron</h1>
				</div>
			</div>
			<div class="row" id="divFacture">
				<div class="col-md-12">
					<table class="table table-bordered">
						<caption><h2>Listing factures</h2></caption>
						<thead>
							<tr>
								<th>Numéro de facture</th>
								<th>Date</th>
								<th>Référence client</th>
								<th>Total facture</th>
							</tr>
						</thead>
						<tbody id="bodyFacture">
						</tbody>
					</table>
				</div>
			</div>
			<div>
				<a href="newFacture.html" class="btn btn-primary pull-right" id="btnNewFacture">Nouvelle facture</a>
			</div>
			<div class="row" id="divClient">
				<div class="col-md-12">
					<table class="table table-bordered">
						<caption><h2>Listing clients</h2></caption>
						<thead>
							<tr>
								<th>Numéro de client</th>
								<th>Nom</th>
								<th>Prénom</th>
								<th>Date dernière facture</th>
							</tr>
						</thead>
						<tbody id="bodyClient">
						</tbody>
					</table>
				</div>
			</div>
			<div>
				<button class="btn btn-primary pull-right" type="button" id="btnNewClient">Nouveau client</button>
			</div>
			<div id="popupClient" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title">Enregistrement d'un nouveau client</h4>
                        </div>
                        <div class="modal-body">
                            <form class="form-horizontal" action="">
                                <div class="row">
                                    <div class="form-group col-md-10">
                                        <label for="nomClient" class="col-md-4 control-label">Nom</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="nomClient" placeholder="Nom">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="prenomClient" class="col-md-4 control-label">Prénom</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="prenomClient" placeholder="Prénom">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="rueClient" class="col-md-4 control-label">Rue</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="rueClient" placeholder="Rue">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="numeroClient" class="col-md-4 control-label">Numéro</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="numeroClient" placeholder="Numéro">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="boiteClient" class="col-md-4 control-label">Boite</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="boiteClient" placeholder="Boite">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="codePostalClient" class="col-md-4 control-label">Code postal</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="codePostalClient" placeholder="Code postal">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="villeClient" class="col-md-4 control-label">Ville</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="villeClient" placeholder="Ville">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="paysClient" class="col-md-4 control-label">Pays</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="paysClient" placeholder="Pays">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="telClient" class="col-md-4 control-label">Téléphone</label>
                                        <div class="col-md-8">
                                            <input type="tel" class="form-control" id="telClient" placeholder="Téléphone">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="mailClient" class="col-md-4 control-label">Email</label>
                                        <div class="col-md-8">
                                            <input type="email" class="form-control" id="mailClient" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="numChassisClient" class="col-md-4 control-label">N° chassis</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="numChassisClient" placeholder="N° de chassis">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label for="plaqueClient" class="col-md-4 control-label">Plaque</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="plaqueClient" placeholder="Plaque">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                            <button type="button" class="btn btn-primary" id="saveClient">Enregistrer</button>
                        </div>
                    </div>
                </div>
            </div>
		</div>
    </body>
    <!--Latest compiled and minified JavaScript -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <!-- source du store js https://github.com/marcuswestin/store.js/ -->
    <script src="../js/store.min.js"></script> <!--librairie de gestion du local storage -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script>
        function afficherFactures() {
            var listeFactures = store.get('liste_Facture');

            if (typeof listeFactures != 'undefined') {
                $.each(listeFactures.facture, function(i, item) {
                    insererFactureTabHTML(listeFactures.facture[i]);
                });
            }
        };

        function insererFactureTabHTML(facture) {
            var tab = $('#bodyFacture'),
                listeClient = store.get('liste_Client'),
                j = null;

            $.each(listeClient.client, function(i, item) {
                if (listeClient.client[i].id == facture.idClient) {
                    j = i;
                }
            });

            tab.append('<tr><td>' + getNumClientFacture(facture.id) + '</td>' +
                '<td>' + facture.date + '</td>' +
                '<td>' + listeClient.client[j].nom + ' ' + listeClient.client[j].prenom + '</td>' +
                '<td>' + facture.total + '</td><td class="lienFacture"><a href="newFacture.html?idFacture=' + facture.id + '" class="glyphicon glyphicon-eye-open"</td></tr>');
        }

        function afficherClients() {
            //recupérer toutes les factures stockées dans le local storage 'liste_Facture'
            //Afficher les informations de la facture dans le <table>
            var listeClients = store.get('liste_Client');

            if (typeof listeClients != 'undefined') {
                $.each(listeClients.client, function(i, item) {
                    insererClientTabHTML(listeClients.client[i]);
                });
            }
        }

        function insererClientTabHTML(client) {
            var tab = $('#bodyClient');
            tab.append('<tr><td>' + getNumClientFacture(client.id) + '</td>' +
                '<td>' + client.nom + '</td>' +
                '<td>' + client.prenom + '</td></tr>');
        }

        function getNumClientFacture(id) {
            var numero = id.toString();
            while (numero.length<6) {
                numero = '0' + numero;
            }
            return numero;
        }

        $(function() {
    		var appli = $('.container');

            //Afficher les dernières factures dans la page web
            afficherFactures();

            //Afficher les clients dans la page web
            afficherClients();

            //Pour une facture "cliquée", ouvrir la page "newFacture.html" avec les informations de la facture en question

            //afficher la modal/popup pour la création d'un nouveau client
            appli.on('click', '#btnNewClient', function() {
    			$('#popupClient').modal('show');
    		});
    	});
    </script>
</html>